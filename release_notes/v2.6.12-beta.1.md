# v2.6.12-beta.1

## üêõ Bug Fixes

**Fixed covers not moving automatically due to capability detection race condition**

Covers were not responding to automatic positioning commands even when all conditions were met (sun visible, control enabled, position delta exceeded). This was caused by a timing issue where cover capabilities were being cached during startup before entities were fully initialized, leading to incorrect capability detection.

### What Changed

- **On-demand capability checking** - Capabilities are now checked fresh before each positioning operation instead of being cached at startup
- **Entity ready detection** - Returns safe defaults when entities aren't fully initialized yet
- **Improved debug logging** - Added detailed logging showing:
  - Raw `supported_features` values and binary representation
  - Detected capabilities for each cover
  - When safe defaults are being used

### Code Quality Improvements

This beta also includes significant code refactoring to improve maintainability:

- Extracted repeated code patterns into reusable helper methods
- Created semantic property accessors for cover types (`is_tilt_cover`, `is_blind_cover`, `is_awning_cover`)
- Split long methods into focused, single-responsibility functions
- Modularized diagnostic data building

**Technical details:**
- Reduced `async_set_manual_position()` from 98 lines to 24 lines with focused helpers
- Eliminated 3 instances of duplicated safe defaults code
- All 180 unit tests passing

## üß™ Testing Instructions

**‚ö†Ô∏è This is a BETA release - please test before using in production!**

### How to Test

1. **Enable debug logging** in `configuration.yaml`:
   ```yaml
   logger:
     default: info
     logs:
       custom_components.adaptive_cover_pro: debug
   ```

2. **Install this beta version** and restart Home Assistant

3. **Verify capability detection** in logs - you should see:
   ```
   Cover cover.your_cover supported_features: 15 (binary: 0b1111)
   Cover cover.your_cover capabilities detected: {'has_set_position': True, ...}
   ```

4. **Test automatic positioning**:
   - Ensure "Control" switch is ON
   - Wait for sun to be in window field of view ("Sun Infront" sensor = ON)
   - Verify calculated position differs from current position by >1%
   - Within 2 minutes, cover should move automatically
   - Check logs for: `Successfully called service set_cover_position for cover.your_cover`

5. **What should work:**
   - Covers move automatically when sun conditions are met
   - No warnings about "does not support both open and close"
   - Debug logs show capability detection for each cover
   - Position commands are sent successfully

### Known Issues

None identified - please report any issues on GitHub!

## üì¶ Installation

### HACS (Recommended)
1. Go to HACS ‚Üí Integrations
2. Click three dots on Adaptive Cover Pro
3. Select "Redownload"
4. Choose version `v2.6.12-beta.1`
5. Restart Home Assistant

### Manual Installation
1. Download `adaptive_cover_pro.zip` from this release
2. Extract to `custom_components/adaptive_cover_pro/`
3. Restart Home Assistant

## üîÑ Upgrading from v2.6.11

This is a drop-in replacement - no configuration changes required.

**Recommended steps:**
1. Enable debug logging (see above)
2. Install beta version
3. Restart Home Assistant
4. Check logs to verify capability detection
5. Test automatic positioning
6. Report any issues

## ‚öôÔ∏è Compatibility

- **Home Assistant:** 2024.5.0+
- **Python:** 3.11+
- **Tested with:** Python 3.11, 3.12, 3.14

## üôè Feedback

This is a beta release for testing the capability detection fix. Please test and provide feedback:

- **Report issues:** https://github.com/basbruss/adaptive-cover/issues
- **Confirm it works:** Comment on the release with your setup details

If testing is successful, this will be released as v2.6.12 stable.
