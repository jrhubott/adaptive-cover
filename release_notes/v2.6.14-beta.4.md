## ğŸ¯ Adaptive Cover Pro v2.6.14-beta.4

**Beta Release** - This is a testing release for the sun visibility transition detection feature.

### âœ¨ Features

**Sun Visibility Transition Detection**
- Covers now immediately respond when sun comes into field of view
- Detects when "Sun Infront" sensor transitions from OFF to ON
- Forces repositioning even when calculated position equals current position
- Resolves issue where covers remained at default position when sun entered field of view at low angles

### ğŸ› Bug Fixes

**Fixed: Covers not moving when sun comes into field of view**
- Previously, covers would not reposition when sun transitioned into the field of view if the calculated position (after min/max clamping) equaled the current position
- This commonly occurred at sunrise with low sun angles (2-5Â° elevation) when min_position was set to 0%
- Now detects sun validity state transitions and bypasses position equality check
- Ensures responsive sun tracking regardless of position limits

### ğŸ”§ Technical Details

**Implementation:**
- Added `_last_sun_validity_state` tracking variable
- Created `_check_sun_validity_transition()` method to detect OFF â†’ ON transitions
- Modified `check_position()` to bypass equality check on sun visibility transitions
- Preserves geometric accuracy (no changes to position calculations)
- One-time trigger per transition (doesn't repeat on steady-state)

**Call Flow:**
1. Sun comes into field of view â†’ `direct_sun_valid` changes False â†’ True
2. Transition detector identifies state change
3. Position equality check bypassed
4. Cover repositioning forced
5. Normal sun tracking resumes

### ğŸ§ª Testing Instructions

**âš ï¸ IMPORTANT: This is a BETA release. Please test thoroughly before relying on it in production.**

**Test Case 1: Sunrise Transition**
1. Configure cover with min_position = 0%
2. Start with sun not in field of view (cover at default 0%)
3. Wait for sun to rise into field of view at low angle (2-5Â° elevation)
4. **Expected:** Cover immediately repositions when sun comes into view
5. **Verify logs:** Look for "Sun visibility transition detected: OFF â†’ ON"
6. **Verify logs:** Look for "Bypassing position equality check: sun just came into field of view"

**Test Case 2: No False Triggers**
1. Sun already in field of view, cover at calculated position
2. Sun angle changes slightly but calculated position remains same
3. **Expected:** No unnecessary cover movements
4. **Verify:** Cover stays at current position when no actual change needed

**Test Case 3: Sun Leaving and Returning**
1. Sun in field of view â†’ Cover at calculated position
2. Sun moves out of field of view â†’ Cover returns to default
3. Sun comes back into field of view
4. **Expected:** Transition detected, cover repositions to calculated position
5. **Verify logs:** Transition detected on return

**Test Case 4: Position Limits**
1. Test with various min_position and max_position configurations
2. Test with "apply during sun tracking" enabled/disabled
3. **Expected:** Transitions detected regardless of limit configuration
4. **Verify:** Cover responds when sun comes into view

**Debug Logging:**
Enable debug logging to see detailed information:
```yaml
logger:
  default: info
  logs:
    custom_components.adaptive_cover_pro: debug
```

### ğŸ“‹ Installation

**Via HACS (Recommended for Beta Testing):**
1. Go to HACS â†’ Integrations
2. Find "Adaptive Cover Pro"
3. Click "Redownload" or update
4. Select version `v2.6.14-beta.4` from the version dropdown
5. Restart Home Assistant

**Manual Installation:**
1. Download `adaptive_cover_pro.zip` from this release
2. Extract to `custom_components/adaptive_cover_pro/`
3. Restart Home Assistant

### âš ï¸ Known Behavior

**Expected Behavior:**
- Transition detection only triggers ONCE per sun visibility change
- After initial repositioning, normal delta filtering resumes
- Works with all cover types (vertical, horizontal, tilt)
- Compatible with all position limit configurations
- No impact on manual override detection

**What to Watch For:**
- Check logs for transition detection messages
- Verify covers respond immediately at sunrise
- Ensure no unnecessary movements during steady-state tracking
- Test with your specific min/max position settings

### ğŸ”„ Upgrading from v2.6.14-beta.3

This release adds new functionality without breaking changes. Simply update and restart.

### ğŸ“ Feedback

Please report any issues or feedback at:
https://github.com/jrhubott/adaptive-cover/issues

Include:
- Debug logs showing transition detection
- Your position limit configuration
- Description of cover behavior
- Sun angles when issue occurred

### ğŸ™ Testing Help Needed

We especially need testing for:
- âœ… Sunrise scenarios with low sun angles (2-10Â° elevation)
- âœ… Various min_position configurations (0%, 5%, 10%, etc.)
- âœ… Different window orientations (azimuth angles)
- âœ… Multiple covers controlled by single integration instance
- âœ… Climate mode enabled configurations

Thank you for helping test this feature!

---

**Related to:** Issue #1 (Shadow calculation accuracy and sun tracking responsiveness)
