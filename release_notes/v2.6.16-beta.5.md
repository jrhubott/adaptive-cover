## ðŸŽ¯ Fix Manual Override False Trigger on HA Restart

This beta release addresses the final edge case in Issue #11 where manual override detection was still falsely triggered when Home Assistant restarts.

### ðŸ› Bug Fixes

**Manual Override Detection on Startup**
- Fixed false manual override triggers on Home Assistant restart
- Added 30-second startup grace period separate from command grace period
- Prevents false triggers when covers respond slowly during system initialization
- Command grace period (5s) continues to prevent false triggers during normal operations
- Both grace periods work independently and can be active simultaneously

**Root Cause:** The previous fix (v2.6.16-beta.3) successfully prevented false triggers during normal automatic movements using a 5-second command grace period. However, on HA restart, systems are under heavy load, covers may be slow to respond, and timing is unpredictable. If a cover takes longer than 5 seconds to reach its target position after restart, the command grace period expires and manual override detection treats the delayed response as a user intervention.

**Solution:** Added a global 30-second startup grace period that begins when the integration initializes. During this period, manual override detection is completely disabled, allowing covers to respond at their own pace without triggering false positives.

### âœ¨ Features

**Startup Grace Period System**
- Automatically activated on Home Assistant restart
- Duration: 30 seconds (conservative for slow systems)
- Scope: Global (applies to all covers)
- Independent of per-entity command grace period
- Automatic cleanup after timeout
- Clear logging for troubleshooting

### ðŸ§ª Testing

- Added 8 comprehensive unit tests for startup grace period
- All 248 tests passing
- Verified startup grace period prevents false triggers
- Verified command grace period still works independently
- Verified both grace periods can be active simultaneously
- Backward compatible with existing installations

### ðŸ“ Technical Details

**Files Modified:**
- `const.py`: Added `STARTUP_GRACE_PERIOD_SECONDS = 30.0`
- `coordinator.py`: Implemented startup grace period tracking and methods
- `tests/test_startup_grace_period.py`: New test file with 8 tests

**Implementation:**
- `_is_in_startup_grace_period()`: Check if in startup grace period
- `_start_startup_grace_period()`: Start grace period on first refresh
- `_startup_grace_period_timeout()`: Auto-cleanup after 30 seconds
- Modified `async_config_entry_first_refresh()`: Start startup grace period
- Modified `async_handle_cover_state_change()`: Check startup grace period before manual override detection

### ðŸ” Log Messages to Watch

When debugging, look for these log entries:

**Startup:**
```
Started 30 second startup grace period (manual override detection disabled)
```

**During Grace Period:**
```
Position change for cover.example ignored (in startup grace period)
```

**After Grace Period:**
```
Startup grace period expired (manual override detection enabled)
```

### ðŸ“¦ Installation

```yaml
# Via HACS:
1. Go to HACS â†’ Integrations
2. Find "Adaptive Cover Pro"
3. Click "Redownload"
4. Select version v2.6.16-beta.4
5. Restart Home Assistant

# Or download directly from GitHub releases
```

### ðŸ§ª Testing Instructions

1. **Test HA restart scenario:**
   - Enable manual override detection in integration settings
   - Configure covers with manual override threshold and duration
   - Restart Home Assistant completely
   - Watch logs for startup grace period messages
   - Verify no false manual override triggers during first 30 seconds
   - After 30 seconds, verify manual override detection works normally

2. **Test slow cover response:**
   - Restart HA and let covers respond naturally
   - Some covers may take 10-20 seconds to reach position
   - Verify no false triggers even for slow covers

3. **Test actual manual changes:**
   - Wait 35+ seconds after HA restart (grace period expired)
   - Manually move a cover using controls
   - Verify manual override IS correctly triggered

4. **Test integration reload:**
   - Use Developer Tools â†’ Services â†’ "Reload Integration"
   - Verify startup grace period restarts
   - Verify no false triggers

### ðŸ”— Related

- Fixes: Issue #11 - Manual Override still triggered by the integration itself
- Previous: v2.6.16-beta.3 (command grace period)
- Branch: `fix/issue-11-manual-override-false-trigger`

### ðŸ“Š Test Coverage

| Component | Tests | Status |
|-----------|-------|--------|
| Startup grace period | 8 | âœ… All passing |
| Command grace period | 7 | âœ… All passing |
| Total integration tests | 248 | âœ… All passing |
| Linting | - | âœ… Clean |

### âš ï¸ Notes

- The 30-second grace period is conservative to handle worst-case scenarios
- Only affects startup/reload scenarios, not normal operation
- Actual manual changes are still detected after grace period expires
- Logging level: INFO for grace period start/stop, DEBUG for ignored changes

Please test this beta release and report:
- âœ“ Whether false triggers on HA restart are eliminated
- âœ“ Whether slow-responding covers (>5s) work correctly
- âœ“ Whether actual manual changes after 30s are still detected
- âœ“ Any unexpected behavior

Thank you for testing!
