## ðŸŽ¯ v2.6.14-beta.2: Enhanced Position Verification and Improved Responsiveness

This beta release focuses on improving the position verification system, reducing response times for time window transitions, and ensuring covers are properly repositioned after Home Assistant restarts.

### âœ¨ Improvements

**Position Verification System:**
- Reduced log noise from position verification - messages now appear once per cover instead of repeating every cycle
- Fixed covers not being repositioned after Home Assistant restart - target positions now properly set during first refresh
- Position verification now works immediately after restart instead of waiting for state changes

**Enhanced Responsiveness:**
- Reduced response time for time window transitions (start/end times) from <2 minutes to <1 minute
- Control Status sensor now updates within 1 minute when end time is reached
- Covers return to default position within 1 minute of end time passing (previously 5+ minutes)

**Time Window Monitoring:**
- Added automatic time window state change detection integrated with position verification cycle
- Clear log messages indicate when time windows activate/deactivate
- More reliable end time handling with widened callback window (1s â†’ 5s)

### ðŸ› Bug Fixes

**Issue 1: Repetitive Debug Messages**
- Fixed continuous "No target position set" debug messages appearing every 2 minutes
- Added tracking system to log the message only once per entity
- Tracking automatically cleared when commands are sent to covers

**Issue 2: Delayed Control Status After End Time**
- Fixed Control Status remaining "Active" for 5+ minutes after end sun time
- Implemented time window transition detection piggybacking on position verification
- Status now updates within 1 minute of time window changes

**Issue 3: Covers Not Repositioned After Restart**
- Fixed covers staying in pre-restart positions indefinitely after Home Assistant restart
- Target positions now populated during first refresh regardless of delta check
- Position verification works immediately after restart
- Delta check still prevents unnecessary movements when covers are already at target

### ðŸ“š Documentation

**New FAQ Section Added:**
- Comprehensive "Response Time and Control Delays" section in README
- Explains expected timing behaviors for all scenarios
- Clarifies why instant responses aren't used (performance balance)
- Provides recommendations for time-critical automations

**Timing Expectations Documented:**
- Time window transitions: <1 minute response time
- Sun position changes: Immediate updates
- After restart: Repositioning within ~30 seconds
- Position verification: Every 1 minute with up to 3 retries

### ðŸ”§ Technical Details

**Changes to coordinator.py:**
- Added `_never_commanded` tracking set for cleaner logging
- Added `_last_time_window_state` for time window transition detection
- Added `_check_time_window_transition()` method
- Modified `async_handle_first_refresh()` to always populate `target_call` dictionary
- Updated `async_periodic_position_check()` to monitor time window transitions
- Improved `_verify_entity_position()` logging to suppress repetitive messages

**Changes to const.py:**
- Updated `POSITION_CHECK_INTERVAL_MINUTES` from 2 to 1 minute

**Backward Compatibility:**
- All changes are backward compatible
- No configuration changes required
- No entity schema changes
- Existing automations continue working

### ðŸ§ª Testing

**Recommended Test Scenarios:**

1. **Log Cleanliness Test:**
   - Fresh restart, monitor logs for 6+ minutes
   - Should see "No command sent to X yet" once per cover only

2. **End Time Response Test:**
   - Configure end time 3 minutes in future
   - Verify Control Status updates within 1 minute after end time
   - Verify covers return to default position within 1 minute
   - Check logs for "Time window state changed" message

3. **Restart Repositioning Test:**
   - Restart Home Assistant while covers are within time window
   - Verify target positions are set during first refresh
   - Verify position verification works immediately
   - Check that unnecessary movements are avoided when already at target

4. **Performance Monitoring:**
   - Monitor system performance during position verification cycles
   - Verify no excessive CPU usage
   - Verify 1-minute intervals are working correctly

### âš ï¸ Known Issues

None specific to this release. See [Known Limitations & Best Practices](https://github.com/JohanHagman/adaptive-cover#known-limitations--best-practices) in README for general limitations.

### ðŸ“¦ Installation

**Beta Testing via HACS:**
1. In HACS, go to Adaptive Cover Pro
2. Click the three dots menu â†’ "Redownload"
3. Enable "Show beta versions"
4. Select v2.6.14-beta.2
5. Restart Home Assistant

**Manual Installation:**
Download `adaptive_cover_pro.zip` from this release and extract to your `custom_components` directory.

### ðŸ™ Feedback

Please report any issues or feedback on the [GitHub Issues](https://github.com/JohanHagman/adaptive-cover/issues) page. This is a beta release for testing - your feedback helps ensure a stable production release.

### ðŸ“Š Testing Checklist

- [ ] Position verification messages appear only once per cover
- [ ] Control Status updates within 1 minute of end time
- [ ] Covers return to default within 1 minute of end time
- [ ] Covers repositioned correctly after Home Assistant restart
- [ ] Target positions set during first refresh (check logs)
- [ ] Position verification works immediately after restart
- [ ] No excessive log spam
- [ ] System performance remains good
- [ ] Time window transitions logged clearly
