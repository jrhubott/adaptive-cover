# v2.6.12

## ğŸ› Bug Fixes

**Fixed covers not moving automatically due to capability detection race condition**

Covers were not responding to automatic positioning commands even when all conditions were met (sun visible, control enabled, position delta exceeded). This was caused by a timing issue where cover capabilities were being cached during startup before entities were fully initialized, leading to incorrect capability detection.

### What Changed

- **On-demand capability checking** - Capabilities are now checked fresh before each positioning operation instead of being cached at startup
- **Entity ready detection** - Returns safe defaults when entities aren't fully initialized yet
- **Improved debug logging** - Added detailed logging showing:
  - Raw `supported_features` values and binary representation
  - Detected capabilities for each cover
  - When safe defaults are being used

### Technical Details

The integration now uses a simpler, more reliable approach:
- No capability caching - checks fresh every time
- Handles entities that aren't ready during startup
- Provides optimistic defaults when `supported_features` attribute is missing
- Enhanced debug logging for troubleshooting

## ğŸ”§ Code Quality Improvements

Significant refactoring to improve maintainability:

- Extracted repeated code patterns into reusable helper methods
- Created semantic property accessors for cover types (`is_tilt_cover`, `is_blind_cover`, `is_awning_cover`)
- Split long methods into focused, single-responsibility functions
- Modularized diagnostic data building

**Technical improvements:**
- Reduced `async_set_manual_position()` from 98 lines to 24 lines with focused helpers
- Eliminated 3 instances of duplicated code
- Broke up `_async_update_data()` from 95 lines to 38 lines
- All 180 unit tests passing

## ğŸ“Š Impact

### Before
- Covers with late-initializing entities would never move automatically
- Warning: "Cover does not support both open and close. Skipping."
- Limited visibility into capability detection issues

### After
- Covers move automatically regardless of initialization timing
- Capabilities checked on-demand before each operation
- Comprehensive debug logging for troubleshooting
- Cleaner, more maintainable codebase

## ğŸ§ª Testing

**Beta tested as v2.6.12-beta.1** - confirmed working with various cover types.

To verify the fix is working, enable debug logging:
```yaml
logger:
  default: info
  logs:
    custom_components.adaptive_cover_pro: debug
```

You should see logs like:
```
Cover cover.your_cover supported_features: 15 (binary: 0b1111)
Cover cover.your_cover: supports_position=True, caps={'has_set_position': True, ...}
Successfully called service set_cover_position for cover.your_cover
```

## ğŸ“¦ Installation

### HACS (Recommended)
1. Go to HACS â†’ Integrations
2. Click three dots on Adaptive Cover Pro
3. Select "Redownload"
4. Restart Home Assistant

### Manual Installation
1. Download `adaptive_cover_pro.zip` from this release
2. Extract to `custom_components/adaptive_cover_pro/`
3. Restart Home Assistant

## ğŸ”„ Upgrading from v2.6.11

This is a drop-in replacement - no configuration changes required.

Simply install the new version and restart Home Assistant.

## âš™ï¸ Compatibility

- **Home Assistant:** 2024.5.0+
- **Python:** 3.11+
- **Tested with:** Python 3.11, 3.12, 3.14

## ğŸ™ Thanks

Thanks to beta testers for validating this release!
