# ðŸŽ¯ Adaptive Cover Pro v2.7.5-beta.4

## Motion-Based Automatic Control

This beta adds **motion-based automatic control** - a powerful new feature that enables/disables sun positioning based on room occupancy.

## âœ¨ Features

### Motion-Based Automatic Control

Configure motion sensors to automatically control when covers use sun positioning based on room occupancy:

**How it works:**
- **When ANY sensor detects motion** â†’ Covers use automatic sun-based positioning for glare control
- **When ALL sensors show no motion for configured timeout** â†’ Covers return to default position (energy savings/privacy)
- **Configurable timeout** (30-3600 seconds, default 300) prevents position flapping from rapid sensor toggling

**Configuration:**
- Add list of binary motion sensors in automation settings
- Set timeout duration to control debounce behavior
- Leave sensor list empty to disable feature (backward compatible)

**Use Cases:**
- **Living room:** Track sun when occupied, close when away
- **Bedroom:** Auto-position during day when present, privacy mode when empty
- **Office:** Glare control when working, default when vacant
- **Multi-room:** OR logic means ANY room with motion enables automatic positioning

**Technical Details:**
- **OR logic:** ANY sensor active = use automatic positioning
- **Debounce "no motion" only:** Immediate response when motion detected, timeout when motion stops
- **Priority:** Force override (safety) > Motion timeout > Manual override
- **Per-instance:** Each integration instance can have different motion sensors
- **Diagnostic data:** Motion state and timeout status exposed in configuration diagnostics

### Control Status Updates

Added new `motion_timeout` status to control status sensor. This helps you understand when covers are using default position due to no occupancy.

## ðŸ§ª Testing

- âœ… All 289 tests passing
- âœ… 22 new comprehensive tests for motion control:
  - OR logic verification (ANY sensor on = motion detected)
  - Timeout and debouncing behavior
  - Priority ordering (force override > motion timeout > manual)
  - Edge cases (unavailable sensors, rapid toggling, shutdown cleanup)
  - Diagnostic data exposure

## ðŸ“š Documentation

- Updated README.md with feature description and configuration variables
- Updated CLAUDE.md with implementation pattern and technical details
- Added translations for motion control UI strings

## Installation

### HACS (Manual URL)
1. Go to HACS â†’ Integrations â†’ â‹® â†’ Custom repositories
2. Add repository URL: `https://github.com/jrhubott/adaptive-cover`
3. Category: Integration
4. Click "Adaptive Cover Pro"
5. Click "Download"
6. Select version `v2.7.5-beta.4`
7. Restart Home Assistant

### Manual
1. Download `adaptive_cover_pro.zip` from this release
2. Extract to `custom_components/adaptive_cover_pro/` in your config directory
3. Restart Home Assistant

## Testing Instructions

1. **Add motion sensors to existing integration instance:**
   - Go to Settings â†’ Devices & Services â†’ Adaptive Cover Pro
   - Click Configure on your integration instance
   - Navigate to Automation settings
   - Add motion sensors (binary_sensor.motion_*)
   - Set timeout duration (default 300 seconds works well)

2. **Test behavior:**
   - Trigger motion sensor â†’ Covers should use automatic sun positioning
   - Wait for timeout after motion stops â†’ Covers should return to default position
   - Check logs for motion detection and timeout messages
   - Check control status sensor for `motion_timeout` status

3. **Verify diagnostic data:**
   - Enable diagnostics in automation settings if not already enabled
   - Check configuration diagnostic sensor attributes for:
     - `motion_sensors`: List of configured sensors
     - `motion_timeout`: Configured timeout duration
     - `motion_detected`: Current motion state (true/false)
     - `motion_timeout_active`: Whether timeout is active (true/false)

## Known Issues

None specific to this feature. This is the fourth beta for v2.7.5 which includes:
- Force override sensors (beta.1, beta.3)
- Motion-based automatic control (beta.4)

Please report issues at: https://github.com/jrhubott/adaptive-cover/issues

## What's Next

After testing, this will be included in the stable v2.7.5 release along with the force override sensors feature from earlier betas.

---

**Full Changelog:** [v2.7.5-beta.3...v2.7.5-beta.4](https://github.com/jrhubott/adaptive-cover/compare/v2.7.5-beta.3...v2.7.5-beta.4)
