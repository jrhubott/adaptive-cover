# v2.7.5-beta.1 - Position Limit Logic Fix (Beta Release)

## ðŸŽ¯ Critical Bug Fix for Issue #24

This beta release fixes a critical bug in position limit logic that caused `min_position` to incorrectly override `sunset_position` after sunset.

## ðŸ› Bug Fixed

**Issue #24: Invalid sunset cover position**

Users with `enable_min_position = True` (only apply when sun in window) experienced incorrect behavior where covers would go to `min_position` instead of `sunset_position` after sunset.

**Example:**
- Configuration: `min_position = 35`, `enable_min_position = True`, `sunset_position = 0`
- **Bug:** Cover went to position 35 after sunset
- **Fixed:** Cover now correctly goes to position 0 after sunset

## ðŸ”§ Technical Changes

### Code Fixes
1. **Fixed `apply_min_position` property** - Inverted boolean logic to match `apply_limits()` expectations
2. **Fixed `apply_max_position` property** - Inverted boolean logic to match `apply_limits()` expectations
3. **Improved code quality** - Changed bitwise `&` to logical `and` in `direct_sun_valid` property

### Root Cause
The properties returned inverted boolean values compared to what the utility function expected:
- Properties returned: `True` = "apply limit", `False` = "don't apply"
- Utility expected: `False` = "always apply", `True` = "conditionally apply"

## ðŸ§ª Testing

### Comprehensive Test Coverage
- **268 total tests** (254 existing + 14 new)
- **100% pass rate**
- Added specific regression test for issue #24
- Full coverage of position limit scenarios

### Test Scenarios Added
- Min/max position with `enable_min/max_position = False` (always apply)
- Min/max position with `enable_min/max_position = True` (conditional)
- Sunset position interaction with min/max limits
- Property behavior verification

## âš ï¸ Breaking Change Notice

**This fix changes behavior for affected users - but the previous behavior was a BUG.**

### Who is Affected?
Users with either:
- `enable_min_position = True` (only apply when sun in window)
- `enable_max_position = True` (only apply when sun in window)

### What Changes?
**Before (Bug):** Limits were always applied, even after sunset
**After (Fix):** Limits only apply when sun is in window (as intended)

### Expected Behavior After Update
- After sunset, covers will correctly use `sunset_position`
- During sun in window, covers will respect `min_position`/`max_position` as configured
- Users with `enable_min/max_position = False` (always apply) are not affected

## ðŸ“‹ Related

- Fixes: [Issue #24](https://github.com/jrhubott/adaptive-cover/issues/24)
- Pull Request: [#25](https://github.com/jrhubott/adaptive-cover/pull/25)

## ðŸš€ Installation

### HACS (Recommended for Beta Testing)

1. Go to HACS â†’ Integrations
2. Click the three dots on Adaptive Cover Pro
3. Click "Redownload"
4. Select version `2.7.5-beta.1`
5. Restart Home Assistant

### Manual Installation

1. Download `adaptive_cover_pro.zip` from this release
2. Extract to `custom_components/adaptive_cover_pro/`
3. Restart Home Assistant

## ðŸ§ª Beta Testing Instructions

**Please test if you:**
- Use `enable_min_position = True` or `enable_max_position = True`
- Use `sunset_position` to return covers to a specific position after sunset
- Have experienced the bug described in issue #24

**What to test:**
1. Verify covers go to `sunset_position` after sunset (not `min_position`)
2. Verify covers respect `min_position` during sun in window
3. Check logs for any errors or warnings
4. Report any issues in [Issue #24](https://github.com/jrhubott/adaptive-cover/issues/24)

## ðŸ“ Testing Checklist

- [ ] After sunset, cover position matches `sunset_position` (not `min_position`)
- [ ] During sun in window, `min_position` is respected
- [ ] During sun in window, calculated position >= `min_position`
- [ ] No errors in Home Assistant logs
- [ ] Cover responds normally to manual control
- [ ] Automation switch still functions correctly

## âš¡ Performance

- No performance impact
- Code quality improved (using `and` instead of `&`)
- Test coverage increased from 20% to 34%

## ðŸ“š Documentation

- Updated docstrings for clarified behavior
- Added inline comments explaining boolean semantics
- Comprehensive test documentation

---

**Note:** This is a **beta release** for testing purposes. Please report any issues before the stable release.
